(function(){var t;t=angular.module("resist",["ui.router","ui.bootstrap"]).config(["$stateProvider","$urlRouterProvider","$urlMatcherFactoryProvider","$locationProvider","$provide",function(t,e,r,n,o){return n.html5Mode(!0),r.strictMode(!1),e.otherwise(function(t,e){return t.invoke(["$state",function(t){return t.go("404")}])}),t.state("lobby",{url:"^/",templateUrl:"lobby.html",controller:"LobbyController as lobby",options:{title:"Game Lobby"}}).state("game",{templateUrl:"game.html",controller:"GameController as game",options:{title:"Game"}}).state("404",{templateUrl:"404.html",options:{title:"Page not found"}}),o.decorator("$q",["$delegate",function(t){var e;return e=t.defer,t.defer=function(){var t;return t=e(),t.promise.success=function(e){return t.promise.then(e),t.promise},t.promise.error=function(e){return t.promise.then(null,e),t.promise},t},t}])}]),t.run(["$rootScope","$state","GameClient",function(t,e,r){}])}).call(this),function(){var t;t=function(){function t(){}return t.prototype.STATE={SETUP:"setup",TEAM_SELECT:"team select",TEAM_VOTE:"team vote",POST_TEAM_VOTE:"post team vote",MISSION:"mission",MISSION_OUTCOME:"mission outcome"},t.prototype.spyCount=function(t){return Math.ceil(t/3)},t.prototype.teamSize=function(t,e){var r;if(5>t||t>10)throw Error("Player count must be between 5 and 10, inclusive");if(1>e||e>5)throw Error("Invalid mission number");return r=[[2,2,2,3,3,3],[3,3,3,4,4,4],[2,4,3,4,4,4],[3,3,4,5,5,5],[3,4,4,5,5,5]],r[e-1][t-5]},t}(),"undefined"!=typeof module&&module.exports?module.exports=new t:angular.module("resist").factory("SharedResources",function(){return new t})}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};angular.module("resist").controller("GameController",["$state","$log","$scope","$timeout","$modal","GameClient","SharedResources",function(e,r,n,o,i,s,a){var l;return new(l=function(){function r(){this.showTip=t(this.showTip,this),this.teamFull=t(this.teamFull,this),this.getTeam=t(this.getTeam,this),this.teamSize=t(this.teamSize,this),this.isLeader=t(this.isLeader,this),this.isSpy=t(this.isSpy,this),this.lockTeam=t(this.lockTeam,this),this.pickMember=t(this.pickMember,this);var r;this.playerId=s.playerId,this.players=s.players,this.state=s.state,this.mission=s.mission,this.votes=s.votes,this.voteSuccess=null,this.shared=a,this.players&&this.playerId||e.go("lobby"),r=i.open({templateUrl:"introModal",controller:"IntroModalController as modal",resolve:{isSpy:function(t){return function(){return t.isSpy()}}(this),spyCount:function(t){return function(){return a.spyCount(Object.keys(t.players).length)}}(this)}}),n.$on("players change",function(t){return function(e,r){return o(function(){return t.players=r})}}(this)),n.$on("state change",function(t){return function(e,n){return o(function(){return t.state=n,n===a.STATE.TEAM_VOTE?(null!=r&&r.dismiss("cancel"),r=i.open({templateUrl:"voteModal",controller:"VoteModalController as modal",keyboard:!1,backdrop:"static",resolve:{team:function(){return t.getTeam().map(function(t){return t.name})}}}),r.result.then(function(t){return s.teamVote(t)},function(){return s.teamVote(!1)})):void 0})}}(this)),n.$on("vote result",function(t){return function(e,n){return o(function(){return null!=r&&r.dismiss("cancel"),t.voteSuccess=n})}}(this))}return r.prototype.pickMember=function(t){return s.toggleMemberForMission(t)},r.prototype.lockTeam=function(){return s.lockTeam()},r.prototype.isSpy=function(){return s.isSpy()},r.prototype.isLeader=function(){return s.isLeader()},r.prototype.teamSize=function(){return s.teamSize()},r.prototype.getTeam=function(){return s.getTeam()},r.prototype.teamFull=function(){return this.getTeam().length===this.teamSize()},r.prototype.showTip=function(){return this.state===a.STATE.TEAM_SELECT||this.state===a.STATE.POST_TEAM_VOTE},r.prototype.getRange=function(t){var e;return function(){e=[];for(var r=1;t>=1?t>=r:r>=t;t>=1?r++:r--)e.push(r);return e}.apply(this)},r}())}]),angular.module("resist").controller("IntroModalController",["$modalInstance","$scope","isSpy","spyCount",function(t,e,r,n){var o;return new(o=function(){function o(){e.isSpy=r,e.spyCount=n}return o.prototype.close=function(){return t.dismiss("cancel")},o}())}]),angular.module("resist").controller("VoteModalController",["$modalInstance","team",function(t,e){var r;return new(r=function(){function r(){this.team=e}return r.prototype.accept=function(){return t.close(!0)},r.prototype.reject=function(){return t.close(!1)},r}())}])}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};angular.module("resist").controller("LobbyController",["$state","$log","$scope","$timeout","$modal","GameClient",function(e,r,n,o,i,s){var a;return new(a=function(){function e(){this.changeName=t(this.changeName,this),this.toggleReady=t(this.toggleReady,this);var e;this.playerId=s.playerId,this.players=s.players,this.ready=this.players?null!=(e=this.players[this.playerId])?e.ready:void 0:!1,n.$on("connected",function(t){return function(e,r){return o(function(){return t.playerId=r})}}(this)),n.$on("players change",function(t){return function(e,r){return o(function(){var e;return t.players=r,t.ready=null!=(e=t.players[t.playerId])?e.ready:void 0})}}(this))}return e.prototype.toggleReady=function(){var t;return s.toggleReady(),this.ready=null!=(t=this.players[this.playerId])?t.ready:void 0},e.prototype.changeName=function(){return i.open({templateUrl:"changeNameModal",controller:"ChangeNameController as modal",resolve:{oldName:function(t){return function(){var e;return null!=(e=t.players[t.playerId])?e.name:void 0}}(this)}}).result.then(function(t){return s.changeName(t)})},e}())}]),angular.module("resist").controller("ChangeNameController",["$modalInstance","oldName",function(e,r){var n;return new(n=function(){function n(){this.changeName=t(this.changeName,this),this.name=r}return n.prototype.changeName=function(){return e.close(this.name)},n.prototype.cancel=function(){return e.dismiss("cancel")},n}())}])}.call(this),function(){var t;t=angular.module("resist"),t.filter("objLength",function(){return function(t){return angular.isObject(t)?Object.keys(t).length:0}})}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};angular.module("resist").factory("GameClient",["$state","$window","$rootScope","SharedResources",function(e,r,n,o){var i;return new(i=function(){function i(){this.getTeam=t(this.getTeam,this),this.teamSize=t(this.teamSize,this),this.isLeader=t(this.isLeader,this),this.isSpy=t(this.isSpy,this),this.teamVote=t(this.teamVote,this),this.lockTeam=t(this.lockTeam,this),this.toggleMemberForMission=t(this.toggleMemberForMission,this),this.toggleReady=t(this.toggleReady,this),this.playersUpdated=t(this.playersUpdated,this),this.setupLobby=t(this.setupLobby,this),s=r.io(),this.playerId=null,this.players=null,this.state=o.STATE.SETUP,this.mission=1,this.votes=0,this.setupLobby(),s.on("game/start",function(t){return function(r){return t.state=r,e.go("game")}}(this)),s.on("game/state",function(t){return function(e){return t.state=e,n.$broadcast("state change",t.state),console.log("Game is changing states: "+e)}}(this)),s.on("game/vote-result",function(t){return n.$broadcast("vote result",t)}),s.on("player/new-leader",function(t){return function(e){var r,n,o;o=t.players;for(r in o)n=o[r],n.leader=r===e;return t.playersUpdated()}}(this)),s.on("player/patch",function(t){return function(e){var r,n,o,i,s;i=e.playerId,r=e.delta,t.players[i]&&(o=t.players[i],console.log("Incoming patch for "+o.name+":"),console.log(r)),t.players[i]||(t.players[i]={});for(n in r)s=r[n],t.players[i][n]=s;return t.playersUpdated()}}(this))}var s;return s=null,i.prototype.setupLobby=function(){return s.on("lobby/connected",function(t){return function(e){var r,o,i,s,a;for(s=e.player,a=e.players,t.playerId=s,t.players={},r=0,o=a.length;o>r;r++)i=a[r],t.players[i.id]=i;return n.$broadcast("connected",s),t.playersUpdated()}}(this)),s.on("reconnect",function(){return e.go("lobby")}),s.on("lobby/leave",function(t){return function(e){return delete t.players[e],t.playersUpdated()}}(this))},i.prototype.playersUpdated=function(){return n.$broadcast("players change",this.players)},i.prototype.changeName=function(t){return s.emit("lobby/change-name",t)},i.prototype.toggleReady=function(){return s.emit("lobby/ready"),this.players[this.playerId].ready=!this.players[this.playerId].ready,this.playersUpdated()},i.prototype.toggleMemberForMission=function(t){return this.isLeader()?(s.emit("game/pick-member",t),this.players[t].onMission=!this.players[t].onMission,this.playersUpdated()):void 0},i.prototype.lockTeam=function(){return this.isLeader()?s.emit("game/lock-mission"):void 0},i.prototype.teamVote=function(t){return this.players[this.playerId].vote=t?"accept":"reject",s.emit("game/team-vote",t)},i.prototype.isSpy=function(){var t;return"spy"===(null!=(t=this.players[this.playerId])?t.role:void 0)},i.prototype.isLeader=function(){var t;return!!(null!=(t=this.players[this.playerId])?t.leader:void 0)},i.prototype.teamSize=function(){return o.teamSize(Object.keys(this.players).length,this.mission)},i.prototype.getTeam=function(){var t,e,r,n;n=[],r=this.players;for(t in r)e=r[t],e.onMission&&n.push(e);return n},i}())}])}.call(this);
//# sourceMappingURL=app.min.js.map