(function(){var t;t=angular.module("resist",["ui.router","ui.bootstrap"]).config(["$stateProvider","$urlRouterProvider","$urlMatcherFactoryProvider","$locationProvider","$provide",function(t,e,n,r,o){return r.html5Mode(!0),n.strictMode(!1),e.otherwise(function(t,e){return t.invoke(["$state",function(t){return t.go("404")}])}),t.state("lobby",{url:"^/",templateUrl:"lobby.html",controller:"LobbyController as lobby"}).state("game-team-select",{templateUrl:"game-1.html",controller:"GamePhaseOneController as game"}).state("game-team-vote",{templateUrl:"game-2.html",controller:"GamePhaseTwoController as game"}).state("game-post-team-vote",{templateUrl:"game-3.html",controller:"GamePhaseThreeController as game"}).state("game-mission",{templateUrl:"game-4.html",controller:"GamePhaseFourController as game"}).state("game-post-mission",{templateUrl:"game-5.html",controller:"GamePhaseFiveController as game"}),o.decorator("$q",["$delegate",function(t){var e;return e=t.defer,t.defer=function(){var t;return t=e(),t.promise.success=function(e){return t.promise.then(e),t.promise},t.promise.error=function(e){return t.promise.then(null,e),t.promise},t},t}])}]),t.run(["$rootScope","$state","$modalStack","GameClient",function(t,e,n,r){return t.$on("$stateChangeStart",function(){return n.dismissAll()})}])}).call(this),function(){var t;t=function(){function t(){}return t.prototype.STATE={SETUP:"setup",TEAM_SELECT:"team select",TEAM_VOTE:"team vote",POST_TEAM_VOTE:"post team vote",MISSION:"mission",POST_MISSION:"post mission"},t.prototype.INTERMISSION=1e4,t.prototype.spyCount=function(t){return Math.ceil(t/3)},t.prototype.teamSize=function(t,e){var n;if(5>t||t>10)throw Error("Player count must be between 5 and 10, inclusive");if(1>e||e>5)throw Error("Invalid mission number");return n=[[2,2,2,3,3,3],[3,3,3,4,4,4],[2,4,3,4,4,4],[3,3,4,5,5,5],[3,4,4,5,5,5]],n[e-1][t-5]},t}(),"undefined"!=typeof module&&module.exports?module.exports=new t:angular.module("resist").factory("SharedResources",function(){return new t})}.call(this),function(){var t,e,n=function(t,e){return function(){return t.apply(e,arguments)}},r=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},o={}.hasOwnProperty;e=angular.module("resist"),t=function(){function t(t,e,n,r){r.players&&r.playerId||t.go("lobby"),this.playerId=r.playerId,this.players=r.players,this.mission=r.mission,this.intermission=r.intermission(),e.$on("players.change",function(t){return function(e,r){return n(function(){return t.players=r})}}(this)),this.isSpy=function(){return r.isSpy()},this.isLeader=function(){return r.isLeader()}}return t}(),e.controller("GamePhaseOneController",["$state","$scope","$timeout","$modal","GameClient","SharedResources",function(e,o,s,i,a,l){var u;return new(u=function(t){function u(){this.teamFull=n(this.teamFull,this),u.__super__.constructor.call(this,e,o,s,a),1===this.mission&&0===a.votes&&i.open({templateUrl:"modals/intro.html",controller:"IntroModalController as modal",resolve:{isSpy:function(t){return function(){return t.isSpy()}}(this),spyCount:function(t){return function(){return l.spyCount(Object.keys(t.players).length)}}(this)}})}return r(u,t),u.prototype.pickMember=function(t){return a.toggleMemberForMission(t)},u.prototype.lockTeam=function(){return a.lockTeam()},u.prototype.teamSize=function(){return a.teamSize()},u.prototype.getTeam=function(){return a.getTeam()},u.prototype.teamFull=function(){return this.getTeam().length===this.teamSize()},u}(t))}]),e.controller("GamePhaseTwoController",["$state","$scope","$timeout","$modal","GameClient",function(e,n,o,s,i){var a;return new(a=function(t){function a(){var t;a.__super__.constructor.call(this,e,n,o,i),t=s.open({templateUrl:"modals/vote.html",controller:"VoteModalController as modal",keyboard:!1,backdrop:"static",resolve:{team:function(){return i.getTeam().map(function(t){return t.name})}}}),t.result.then(function(t){return function(t){return i.teamVote(t)}}(this),function(t){return function(){return i.teamVote(!1)}}(this))}return r(a,t),a}(t))}]),e.controller("GamePhaseThreeController",["$state","$scope","$timeout","GameClient",function(e,n,o,s){var i;return new(i=function(t){function i(){i.__super__.constructor.call(this,e,n,o,s),this.voteSuccess=s.lastVoteResult,n.$on("vote.result",function(t){return function(e,n){return o(function(){return t.voteSuccess=n})}}(this))}return r(i,t),i}(t))}]),e.controller("GamePhaseFourController",["$state","$scope","$timeout","$modal","GameClient",function(e,n,o,s,i){var a;return new(a=function(t){function a(){var t;a.__super__.constructor.call(this,e,n,o,i),this.onMission=i.isOnMission(),this.onMission&&(t=s.open({templateUrl:"modals/mission.html",controller:"MissionModalController as modal",keyboard:!1,backdrop:"static",resolve:{isSpy:function(){return i.isSpy()}}}),t.result.then(function(t){return function(t){return i.missionReport(t)}}(this),function(t){return function(){return i.missionReport(!0)}}(this)))}return r(a,t),a}(t))}]),e.controller("GamePhaseFiveController",["$state","$scope","$timeout","GameClient",function(e,n,o,s){var i;return new(i=function(t){function i(){i.__super__.constructor.call(this,e,n,o,s)}return r(i,t),i}(t))}]),e.controller("IntroModalController",["$modalInstance","$scope","isSpy","spyCount",function(t,e,n,r){var o;return new(o=function(){function o(){e.isSpy=n,e.spyCount=r}return o.prototype.close=function(){return t.dismiss("cancel")},o}())}]),e.controller("VoteModalController",["$modalInstance","team",function(t,e){var n;return new(n=function(){function n(){this.team=e}return n.prototype.accept=function(){return t.close(!0)},n.prototype.reject=function(){return t.close(!1)},n}())}]),e.controller("MissionModalController",["$modalInstance","isSpy",function(t,e){var n;return new(n=function(){function n(){this.isSpy=e}return n.prototype.success=function(){return t.close(!0)},n.prototype.fail=function(){return t.close(!1)},n}())}])}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};angular.module("resist").controller("LobbyController",["$state","$log","$scope","$timeout","$modal","GameClient",function(e,n,r,o,s,i){var a;return new(a=function(){function e(){this.changeName=t(this.changeName,this),this.toggleReady=t(this.toggleReady,this);var e;this.playerId=i.playerId,this.players=i.players,this.ready=this.players?null!=(e=this.players[this.playerId])?e.ready:void 0:!1,r.$on("connected",function(t){return function(e,n){return o(function(){return t.playerId=n})}}(this)),r.$on("players.change",function(t){return function(e,n){return o(function(){var e;return t.players=n,t.ready=null!=(e=t.players[t.playerId])?e.ready:void 0})}}(this))}return e.prototype.toggleReady=function(){var t;return i.toggleReady(),this.ready=null!=(t=this.players[this.playerId])?t.ready:void 0},e.prototype.changeName=function(){return s.open({templateUrl:"changeNameModal",controller:"ChangeNameController as modal",resolve:{oldName:function(t){return function(){var e;return null!=(e=t.players[t.playerId])?e.name:void 0}}(this)}}).result.then(function(t){return i.changeName(t)})},e}())}]),angular.module("resist").controller("ChangeNameController",["$modalInstance","oldName",function(e,n){var r;return new(r=function(){function r(){this.changeName=t(this.changeName,this),this.name=n}return r.prototype.changeName=function(){return e.close(this.name)},r.prototype.cancel=function(){return e.dismiss("cancel")},r}())}])}.call(this),function(){var t;t=angular.module("resist"),t.directive("playerTable",function(){return{restrict:"E",transclude:!0,replace:!0,scope:!0,template:'<table class="table table-striped">\n  <thead>\n    <tr>\n      <th colspan="2">Players</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr ng-repeat="player in game.players">\n      <td>\n        <i class="fa fa-fw" ng-class="{\'fa-user\': player.role === \'resistance\', \'fa-user-secret\': player.role === \'spy\'}"></i>\n        {{ player.name }}\n        <span class="text-muted" ng-if="player.id === game.playerId">(You)</span>\n        <i class="fa fa-fw" ng-class="{\'fa-star\': player.leader}"></i>\n      </td>\n      <td>\n        <div inject></div>\n      </td>\n    </tr>\n  </tbody>\n</table>'}}),t.directive("scoreBoard",["GameClient",function(t){return{restrict:"E",scope:!1,link:function(e){var n;return e.getRange=function(t){var e;return function(){e=[];for(var n=1;t>=1?t>=n:n>=t;t>=1?n++:n--)e.push(n);return e}.apply(this)},n=function(){return e.votes=t.votes,e.lastVote=t.lastVoteResult},e.$on("vote.result",n),n(),e.roundWins=t.roundWins},template:'<table class="table table-striped">\n  <thead>\n    <tr>\n      <th></th>\n      <th ng-repeat="i in getRange(5)" class="text-center">{{ i }}</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>Votes</th>\n      <td ng-repeat="i in getRange(5)" class="text-center">\n        <i class="fa fa-fw" ng-class="{\'fa-times-circle text-danger\': i < votes || i === votes && !lastVote, \'fa-check-circle text-success\': i === votes && lastVote}"></i>\n      </td>\n    </tr>\n    <tr>\n      <th>Mission</th>\n      <td ng-repeat="i in getRange(5)" class="text-center">\n        <i class="fa fa-fw" ng-class="{\'fa-rebel text-success\': roundWins[i] === \'resistance\', \'fa-empire text-danger\': roundWins[i] === \'spy\'}"></i>\n      </td>\n    </tr>\n  </tbody>\n</table>'}}]),t.directive("inject",function(){return{link:function(t,e,n,r,o){var s;if(!o)throw minErr("ngTransclude")("orphan","Illegal use of ngTransclude directive in the template! No parent directive that requires a transclusion found. Element: {0}",startingTag(e));return s=t.$new(),o(s,function(t){return e.empty(),e.append(t),e.on("$destroy",function(){return s.$destroy()})})}}})}.call(this),function(){var t;t=angular.module("resist"),t.filter("objLength",function(){return function(t){return angular.isObject(t)?Object.keys(t).length:0}})}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};angular.module("resist").factory("GameClient",["$state","$window","$rootScope","SharedResources",function(e,n,r,o){var s;return new(s=function(){function s(){this.getTeam=t(this.getTeam,this),this.teamSize=t(this.teamSize,this),this.isOnMission=t(this.isOnMission,this),this.isLeader=t(this.isLeader,this),this.isSpy=t(this.isSpy,this),this.missionReport=t(this.missionReport,this),this.teamVote=t(this.teamVote,this),this.lockTeam=t(this.lockTeam,this),this.toggleMemberForMission=t(this.toggleMemberForMission,this),this.toggleReady=t(this.toggleReady,this),this.playersUpdated=t(this.playersUpdated,this),this.setupLobby=t(this.setupLobby,this);var s;i=n.io(),this.playerId=null,this.players=null,this.state=o.STATE.SETUP,this.mission=1,this.votes=0,this.lastVoteResult=null,this.roundWins=[],this.setupLobby(),s=function(t){return function(n){return t.state=n,e.go("game-"+n.replace(/ /g,"-").toLowerCase()),console.log("Game is changing states: "+n)}}(this),i.on("game/start",s),i.on("game/state",s),i.on("game/vote-result",function(t){return function(e){return t.votes++,t.lastVoteResult=e,r.$broadcast("vote.result",e)}}(this)),i.on("game/mission-vote",function(t){return function(e){var n,r;return n=e.mission,r=e.vote,t.mission=n,t.votes=r}}(this)),i.on("player/new-leader",function(t){return function(e){var n,r,o;o=t.players;for(n in o)r=o[n],r.leader=n===e;return t.playersUpdated()}}(this)),i.on("game/score",function(t){return function(e){return t.roundWins=e}}(this)),i.on("player/patch",function(t){return function(e){var n,r,o,s,i;s=e.playerId,n=e.delta,t.players[s]&&(o=t.players[s],console.log("Incoming patch for "+o.name+":"),console.log(n)),t.players[s]||(t.players[s]={});for(r in n)i=n[r],t.players[s][r]=i;return t.playersUpdated()}}(this))}var i;return i=null,s.prototype.setupLobby=function(){return i.on("lobby/connected",function(t){return function(e){var n,o,s,i,a;for(i=e.player,a=e.players,t.playerId=i,t.players={},n=0,o=a.length;o>n;n++)s=a[n],t.players[s.id]=s;return r.$broadcast("connected",i),t.playersUpdated()}}(this)),i.on("reconnect",function(){return e.go("lobby")}),i.on("lobby/leave",function(t){return function(e){return delete t.players[e],t.playersUpdated()}}(this))},s.prototype.playersUpdated=function(){return r.$broadcast("players.change",this.players)},s.prototype.changeName=function(t){return i.emit("lobby/change-name",t)},s.prototype.toggleReady=function(){return i.emit("lobby/ready"),this.players[this.playerId].ready=!this.players[this.playerId].ready,this.playersUpdated()},s.prototype.toggleMemberForMission=function(t){return this.isLeader()?(i.emit("game/pick-member",t),this.players[t].onMission=!this.players[t].onMission,this.playersUpdated()):void 0},s.prototype.lockTeam=function(){return this.isLeader()?i.emit("game/lock-mission"):void 0},s.prototype.teamVote=function(t){return this.players[this.playerId].vote=t?"accept":"reject",i.emit("game/team-vote",t)},s.prototype.missionReport=function(t){return this.isOnMission()?i.emit("game/mission-report",t):void 0},s.prototype.isSpy=function(){var t;return"spy"===(null!=(t=this.players[this.playerId])?t.role:void 0)},s.prototype.isLeader=function(){var t;return!!(null!=(t=this.players[this.playerId])?t.leader:void 0)},s.prototype.isOnMission=function(){var t;return!!(null!=(t=this.players[this.playerId])?t.onMission:void 0)},s.prototype.teamSize=function(){return o.teamSize(Object.keys(this.players).length,this.mission)},s.prototype.intermission=function(){return o.INTERMISSION/1e3},s.prototype.getTeam=function(){var t,e,n,r;r=[],n=this.players;for(t in n)e=n[t],e.onMission&&r.push(e);return r},s}())}])}.call(this);
//# sourceMappingURL=app.min.js.map